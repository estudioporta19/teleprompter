<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teleprompter Profissional</title>
    <style>
        /* Estilos globais e reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif; /* Usando Font Inter conforme instru√ß√£o */
        }

        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow: hidden; /* Evita scroll na p√°gina principal */
        }

        /* Painel de Controlo */
        .control-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto; /* Permite scroll no painel de controlo em telas pequenas */
        }

        .control-panel.hidden {
            display: none;
        }

        /* Cabe√ßalho */
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px; /* Cantos arredondados */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); /* Borda sutil */
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Grelha de Controlo */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Responsivo para colunas */
            gap: 20px;
            flex: 1;
        }

        /* Sec√ß√µes de Controlo */
        .control-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px; /* Cantos arredondados */
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* Sombra para profundidade */
        }

        .control-section h3 {
            margin-bottom: 15px;
            color: #4ecdc4;
            font-size: 1.3em;
        }

        /* Textarea */
        textarea {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #4ecdc4;
            border-radius: 10px; /* Cantos arredondados */
            padding: 15px;
            color: white;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            margin-bottom: 10px;
        }

        textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Input de Ficheiro */
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border-radius: 25px; /* Cantos arredondados */
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        /* Bot√µes de Controlo */
        .control-button {
            padding: 15px 30px;
            margin: 5px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            border-radius: 25px; /* Cantos arredondados */
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }

        .control-button.danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .control-button.success {
            background: linear-gradient(45deg, #51cf66, #40c057);
        }

        /* Sliders */
        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 8px;
            color: #4ecdc4;
            font-weight: bold;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.6);
        }

        /* Ecr√£ do Teleprompter (Display) */
        .teleprompter-display {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #000;
            color: white;
            display: none; /* Escondido por padr√£o */
            overflow: hidden;
            touch-action: pan-y; /* Permite scroll vertical touch */
        }

        .teleprompter-display.active {
            display: block;
        }

        .text-content {
            padding: 50px;
            font-size: 48px; /* Tamanho de fonte padr√£o */
            line-height: 1.6;
            font-family: 'Arial', sans-serif;
            white-space: pre-wrap; /* Preserva espa√ßos e quebras de linha */
            transform: translateY(100vh); /* Come√ßa fora do ecr√£ */
            transition: transform 0.1s linear; /* Rolagem suave */
            /* Centraliza o texto horizontalmente */
            text-align: center; 
            width: 100%;
            box-sizing: border-box; /* Garante que padding n√£o cause overflow */
        }

        /* Instru√ß√µes */
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px; /* Cantos arredondados */
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #4ecdc4;
        }

        .instructions h4 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .instructions ul {
            list-style: none;
            padding-left: 0;
        }

        .instructions li {
            margin: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .instructions li:before {
            content: "‚ñ∂";
            position: absolute;
            left: 0;
            color: #4ecdc4;
        }

        /* Status */
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px; /* Cantos arredondados */
            font-weight: bold;
            z-index: 1001;
            display: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            opacity: 0; /* Escondido por padr√£o */
            transition: opacity 0.3s ease-in-out;
        }

        .status.show {
            display: block;
            opacity: 1;
        }
        .status.error {
            background-color: #e74c3c;
        }
        .status.success {
            background-color: #27ae60;
        }
        .status.info {
            background-color: #3498db;
        }

        /* Media Queries para Responsividade */
        @media (max-width: 768px) {
            .control-grid {
                grid-template-columns: 1fr; /* Uma coluna em telas menores */
            }
            
            .text-content {
                padding: 30px;
                font-size: 32px; /* Reduz o tamanho da fonte para telas menores */
            }

            .control-panel {
                padding: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .control-button {
                width: 100%; /* Bot√µes ocupam a largura total */
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="status" id="status"></div>

    <div class="control-panel" id="controlPanel">
        <div class="header">
            <h1>üì∫ Teleprompter Pro</h1>
            <p>Sistema profissional de teleprompter com controlo avan√ßado</p>
        </div>

        <div class="control-grid">
            <div class="control-section">
                <h3>üìù Texto do Teleprompter</h3>
                <textarea id="textInput" placeholder="Escreva ou cole aqui o seu texto para o teleprompter...

Pode usar quebras de linha normais.
O texto rolar√° suavemente durante a apresenta√ß√£o.

Dica: Use frases curtas e par√°grafos bem definidos para melhor legibilidade."></textarea>
                
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" class="file-input" accept=".txt">
                    <label for="fileInput" class="file-label">üìÅ Carregar Ficheiro TXT</label>
                </div>
            </div>

            <div class="control-section">
                <h3>‚öôÔ∏è Controlos</h3>
                
                <div class="slider-container">
                    <label for="speedSlider">Velocidade: <span id="speedValue">2.0</span></label>
                    <input type="range" id="speedSlider" class="slider" min="0.5" max="5" value="2" step="0.1">
                </div>

                <div class="slider-container">
                    <label for="fontSizeSlider">Tamanho da Fonte: <span id="fontSizeValue">48</span>px</label>
                    <input type="range" id="fontSizeSlider" class="slider" min="24" max="80" value="48" step="2">
                </div>

                <button class="control-button success" onclick="startTeleprompter()">üöÄ Iniciar Teleprompter</button>
                <button class="control-button" onclick="openNewWindow()">üñ•Ô∏è Abrir em Nova Janela</button>
                <button class="control-button danger" onclick="resetTeleprompter()">üîÑ Reset</button>
            </div>

            <div class="control-section">
                <h3>üéÆ Controlos do Teclado</h3>
                <div class="instructions">
                    <h4>Durante a apresenta√ß√£o:</h4>
                    <ul>
                        <li><strong>ESPA√áO</strong> - Play/Pause</li>
                        <li><strong>‚Üë</strong> - Acelerar</li>
                        <li><strong>‚Üì</strong> - Desacelerar</li>
                        <li><strong>‚Üê</strong> - Recuar</li>
                        <li><strong>‚Üí</strong> - Avan√ßar</li>
                        <li><strong>ESC</strong> - Sair do teleprompter</li>
                        <li><strong>R</strong> - Reiniciar do in√≠cio</li>
                    </ul>
                </div>
            </div>

            <div class="control-section">
                <h3>üì± Controlos Touch</h3>
                <div class="instructions">
                    <h4>Gestos dispon√≠veis:</h4>
                    <ul>
                        <li><strong>Swipe Up</strong> - Acelerar rolagem</li>
                        <li><strong>Swipe Down</strong> - Desacelerar/Parar</li>
                        <li><strong>Tap</strong> - Play/Pause</li>
                        <li><strong>Long Press</strong> - Reset posi√ß√£o</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="teleprompter-display" id="teleprompterDisplay">
        <div class="text-content" id="textContent"></div>
    </div>

    <script>
        class TeleprompterController {
            constructor() {
                this.isRunning = false;
                this.speed = 2;
                this.fontSize = 48;
                this.currentPosition = 0;
                this.animationId = null;
                this.textContent = '';
                this.newWindow = null; // Refer√™ncia para a nova janela

                // Touch handling
                this.startY = 0;
                this.startTime = 0;
                this.isLongPress = false;
                this.touchSensitivity = 50; // Pixels para detectar swipe
                this.longPressThreshold = 500; // Milissegundos para long press
                
                this.initializeElements();
                this.setupEventListeners();
                this.loadSampleText();
                this.updateFontSize(); // Garante que a fonte inicial esteja correta
            }

            initializeElements() {
                this.elements = {
                    controlPanel: document.getElementById('controlPanel'),
                    teleprompterDisplay: document.getElementById('teleprompterDisplay'),
                    textInput: document.getElementById('textInput'),
                    textContentDiv: document.getElementById('textContent'),
                    fileInput: document.getElementById('fileInput'),
                    speedSlider: document.getElementById('speedSlider'),
                    fontSizeSlider: document.getElementById('fontSizeSlider'),
                    speedValue: document.getElementById('speedValue'),
                    fontSizeValue: document.getElementById('fontSizeValue'),
                    status: document.getElementById('status')
                };
            }

            setupEventListeners() {
                // File input
                this.elements.fileInput.addEventListener('change', (e) => this.loadFile(e));
                
                // Sliders
                this.elements.speedSlider.addEventListener('input', (e) => {
                    this.speed = parseFloat(e.target.value);
                    this.elements.speedValue.textContent = this.speed.toFixed(1);
                    // Se estiver a rolar na nova janela, atualiza l√° tamb√©m
                    if (this.newWindow && !this.newWindow.closed && this.newWindow.teleprompterInstance) {
                        this.newWindow.teleprompterInstance.speed = this.speed;
                    }
                });

                this.elements.fontSizeSlider.addEventListener('input', (e) => {
                    this.fontSize = parseInt(e.target.value);
                    this.elements.fontSizeValue.textContent = this.fontSize;
                    this.updateFontSize();
                });

                // Keyboard controls
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));

                // Touch controls (no display principal)
                this.elements.teleprompterDisplay.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: false });
                this.elements.teleprompterDisplay.addEventListener('touchend', (e) => this.handleTouchEnd(e), { passive: false });
                // Previne o scroll padr√£o da p√°gina durante o touchmove no display
                this.elements.teleprompterDisplay.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });

                // Click controls (no display principal)
                this.elements.teleprompterDisplay.addEventListener('click', () => this.togglePlayPause());

                // Text input changes
                this.elements.textInput.addEventListener('input', () => {
                    this.textContent = this.elements.textInput.value;
                    // Se a nova janela estiver aberta, atualiza o texto l√° tamb√©m
                    if (this.newWindow && !this.newWindow.closed) {
                        const newWindowTextContent = this.newWindow.document.getElementById('textContent');
                        if (newWindowTextContent) {
                            newWindowTextContent.textContent = this.textContent;
                            // Reset position in new window if text changes significantly
                            if (this.newWindow.teleprompterInstance) {
                                this.newWindow.teleprompterInstance.textContent = this.textContent;
                                this.newWindow.teleprompterInstance.resetPosition();
                            }
                        }
                    }
                });

                // Window close detection for the new window
                window.addEventListener('beforeunload', () => {
                    if (this.newWindow && !this.newWindow.closed) {
                        this.newWindow.close();
                    }
                });
            }

            loadSampleText() {
                const sampleText = `Bem-vindos ao Teleprompter Profissional!

Este √© um sistema avan√ßado de teleprompter que permite controlo total atrav√©s do teclado e gestos touch.

Pode carregar o seu pr√≥prio texto ou ficheiro TXT, ajustar a velocidade de rolagem em tempo real, e controlar tudo com teclas simples.

Funcionalidades principais:
- Rolagem suave e control√°vel
- Ajuste de velocidade em tempo real
- Controlos por teclado e touch
- Suporte para ficheiros TXT
- Interface responsiva
- Modo de ecr√£ completo

Para come√ßar, substitua este texto pelo seu conte√∫do e clique em "Iniciar Teleprompter".

Boa apresenta√ß√£o!`;

                this.elements.textInput.value = sampleText;
                this.textContent = sampleText;
            }

            loadFile(event) {
                const file = event.target.files[0];
                if (file && file.type === 'text/plain') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.textContent = e.target.result;
                        this.elements.textInput.value = this.textContent;
                        this.showStatus('Ficheiro carregado com sucesso!', 'success');
                        // Se a nova janela estiver aberta, atualiza o texto l√°
                        if (this.newWindow && !this.newWindow.closed) {
                            const newWindowTextContent = this.newWindow.document.getElementById('textContent');
                            if (newWindowTextContent) {
                                newWindowTextContent.textContent = this.textContent;
                                if (this.newWindow.teleprompterInstance) {
                                    this.newWindow.teleprompterInstance.textContent = this.textContent;
                                    this.newWindow.teleprompterInstance.resetPosition();
                                }
                            }
                        }
                    };
                    reader.readAsText(file);
                } else {
                    this.showStatus('Por favor, selecione um ficheiro TXT v√°lido.', 'error');
                }
            }

            handleKeyboard(event) {
                // Se a nova janela estiver aberta e ativa, os controlos do teclado aplicam-se a ela.
                // Caso contr√°rio, aplicam-se ao display principal (se ativo).
                const targetTeleprompter = (this.newWindow && !this.newWindow.closed && this.newWindow.teleprompterInstance) 
                                           ? this.newWindow.teleprompterInstance 
                                           : (this.elements.teleprompterDisplay.classList.contains('active') ? this : null);
                
                if (!targetTeleprompter) return; // Nenhum teleprompter ativo para controlo

                switch(event.code) {
                    case 'Space':
                        event.preventDefault();
                        targetTeleprompter.togglePlayPause();
                        break;
                    case 'ArrowUp':
                        event.preventDefault();
                        targetTeleprompter.adjustSpeed(0.2);
                        break;
                    case 'ArrowDown':
                        event.preventDefault();
                        targetTeleprompter.adjustSpeed(-0.2);
                        break;
                    case 'ArrowLeft':
                        event.preventDefault();
                        targetTeleprompter.adjustPosition(-100);
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        targetTeleprompter.adjustPosition(100);
                        break;
                    case 'Escape':
                        event.preventDefault();
                        // Se estiver na janela principal, sai. Se estiver na nova janela, fecha a nova janela.
                        if (targetTeleprompter === this) {
                             this.exitTeleprompter();
                        } else if (this.newWindow && !this.newWindow.closed) {
                            this.newWindow.close();
                            this.newWindow = null; // Limpa a refer√™ncia
                            this.showStatus('Janela secund√°ria fechada', 'info');
                        }
                        break;
                    case 'KeyR':
                        event.preventDefault();
                        targetTeleprompter.resetPosition();
                        break;
                }
            }

            handleTouchStart(event) {
                event.preventDefault(); // Previne o scroll e outros comportamentos padr√£o do browser
                const touch = event.touches[0];
                this.startY = touch.clientY;
                this.startTime = Date.now();
                this.isLongPress = false;

                // Long press detection
                this.longPressTimeout = setTimeout(() => {
                    if (Date.now() - this.startTime >= this.longPressThreshold) {
                        this.isLongPress = true;
                        this.resetPosition();
                        this.showStatus('Posi√ß√£o reiniciada', 'info');
                    }
                }, this.longPressThreshold);
            }

            handleTouchEnd(event) {
                event.preventDefault(); // Previne o scroll e outros comportamentos padr√£o do browser
                clearTimeout(this.longPressTimeout); // Limpa o timeout para evitar falso long press
                if (this.isLongPress) return;

                const touch = event.changedTouches[0];
                const endY = touch.clientY;
                const deltaY = this.startY - endY;
                const deltaTime = Date.now() - this.startTime;

                if (Math.abs(deltaY) < 30 && deltaTime < 300) {
                    // Tap
                    this.togglePlayPause();
                } else if (Math.abs(deltaY) > this.touchSensitivity) {
                    // Swipe
                    if (deltaY > 0) {
                        // Swipe up - speed up
                        this.adjustSpeed(0.5);
                        this.showStatus('Velocidade aumentada', 'info');
                    } else {
                        // Swipe down - slow down or stop
                        if (this.speed > 0.5) {
                            this.adjustSpeed(-0.5);
                            this.showStatus('Velocidade diminu√≠da', 'info');
                        } else {
                            this.pause();
                            this.showStatus('Pausado', 'info');
                        }
                    }
                }
            }

            togglePlayPause() {
                if (this.isRunning) {
                    this.pause();
                } else {
                    this.play();
                }
            }

            play() {
                if (!this.textContent.trim()) {
                    this.showStatus('Adicione texto antes de iniciar!', 'error');
                    return;
                }

                this.isRunning = true;
                this.showStatus('Reproduzindo', 'success');
                this.animate();
            }

            pause() {
                this.isRunning = false;
                this.showStatus('Pausado', 'info');
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
            }

            animate() {
                if (!this.isRunning) return;

                this.currentPosition += this.speed;
                // Move o conte√∫do para cima. O 100vh inicial garante que o texto comece fora do ecr√£.
                // Divide por 10 para tornar a velocidade mais sens√≠vel, pois translateY usa VH.
                this.elements.textContentDiv.style.transform = `translateY(${window.innerHeight - (this.currentPosition / 10)}px)`;

                // Verifica se o topo do conte√∫do atingiu a posi√ß√£o de "fim"
                // A posi√ß√£o m√°xima √© calculada para que o √∫ltimo par√°grafo saia do ecr√£
                const maxScrollPosition = this.elements.textContentDiv.scrollHeight - (window.innerHeight * 0.1); // Ajuste fino para o final
                
                if (this.currentPosition / 10 >= maxScrollPosition) {
                    this.pause();
                    this.showStatus('Fim do texto alcan√ßado', 'info');
                    // Opcional: Reiniciar automaticamente ou voltar ao in√≠cio
                    // this.resetPosition(); 
                    return;
                }

                this.animationId = requestAnimationFrame(() => this.animate());
            }

            adjustSpeed(delta) {
                this.speed = Math.max(0.5, Math.min(5, this.speed + delta)); // Limites de velocidade 0.5 a 5
                this.elements.speedSlider.value = this.speed;
                this.elements.speedValue.textContent = this.speed.toFixed(1);
                this.showStatus(`Velocidade: ${this.speed.toFixed(1)}`, 'info');
                // Sincronizar velocidade com a nova janela, se aberta
                if (this.newWindow && !this.newWindow.closed && this.newWindow.teleprompterInstance) {
                    this.newWindow.teleprompterInstance.speed = this.speed;
                }
            }

            adjustPosition(delta) {
                // Ajusta a posi√ß√£o, mantendo-a dentro dos limites do conte√∫do.
                const contentHeight = this.elements.textContentDiv.scrollHeight;
                const windowHeight = window.innerHeight;
                const maxPositionPx = contentHeight + (windowHeight * 0.1); // Permite o texto sair um pouco do ecr√£

                let newPosition = this.currentPosition + delta;

                // Garante que a posi√ß√£o n√£o seja negativa e n√£o ultrapasse o final do conte√∫do vis√≠vel
                this.currentPosition = Math.max(0, Math.min(maxPositionPx * 10, newPosition)); // * 10 para converter em "unidades" da velocidade
                this.elements.textContentDiv.style.transform = `translateY(${window.innerHeight - (this.currentPosition / 10)}px)`;
                this.showStatus('Ajustando posi√ß√£o', 'info');

                 // Sincronizar posi√ß√£o com a nova janela, se aberta
                if (this.newWindow && !this.newWindow.closed && this.newWindow.teleprompterInstance) {
                    this.newWindow.teleprompterInstance.currentPosition = this.currentPosition;
                    this.newWindow.teleprompterInstance.elements.textContentDiv.style.transform = `translateY(${this.newWindow.innerHeight - (this.newWindow.teleprompterInstance.currentPosition / 10)}px)`;
                }
            }
            
            resetPosition() {
                this.currentPosition = 0;
                this.elements.textContentDiv.style.transform = `translateY(${window.innerHeight}px)`;
                this.showStatus('Posi√ß√£o reiniciada', 'info');
                // Sincronizar posi√ß√£o com a nova janela, se aberta
                if (this.newWindow && !this.newWindow.closed && this.newWindow.teleprompterInstance) {
                    this.newWindow.teleprompterInstance.currentPosition = 0;
                    this.newWindow.teleprompterInstance.elements.textContentDiv.style.transform = `translateY(${this.newWindow.innerHeight}px)`;
                }
            }

            // Esta fun√ß√£o n√£o √© mais necess√°ria para o c√°lculo do maxPosition din√¢mico
            // J√° que a l√≥gica foi incorporada em animate() e adjustPosition()

            updateFontSize() {
                this.elements.textContentDiv.style.fontSize = `${this.fontSize}px`;
                if (this.newWindow && !this.newWindow.closed) {
                    const newWindowTextContent = this.newWindow.document.getElementById('textContent');
                    if (newWindowTextContent) {
                        newWindowTextContent.style.fontSize = `${this.fontSize}px`;
                    }
                }
            }

            startTeleprompter() {
                this.textContent = this.elements.textInput.value;
                if (!this.textContent.trim()) {
                    this.showStatus('Adicione texto antes de iniciar!', 'error');
                    return;
                }

                this.elements.textContentDiv.textContent = this.textContent;
                this.updateFontSize(); // Aplica o tamanho da fonte
                this.resetPosition(); // Reinicia a posi√ß√£o para o in√≠cio
                
                this.elements.controlPanel.classList.add('hidden');
                this.elements.teleprompterDisplay.classList.add('active');
                
                this.showStatus('Teleprompter iniciado - Pressione ESPA√áO ou toque para come√ßar', 'success');
            }

            exitTeleprompter() {
                this.pause();
                this.elements.controlPanel.classList.remove('hidden');
                this.elements.teleprompterDisplay.classList.remove('active');
                this.showStatus('Teleprompter fechado', 'info');
            }

            resetTeleprompter() {
                this.pause();
                this.resetPosition();
                this.speed = 2;
                this.elements.speedSlider.value = 2;
                this.elements.speedValue.textContent = '2.0';
                this.showStatus('Teleprompter reiniciado', 'info');
            }

            openNewWindow() {
                if (!this.textContent.trim()) {
                    this.showStatus('Adicione texto antes de abrir nova janela!', 'error');
                    return;
                }

                // Fecha a janela existente se houver uma para evitar m√∫ltiplas
                if (this.newWindow && !this.newWindow.closed) {
                    this.newWindow.close();
                    this.newWindow = null;
                }

                const newWindowHtml = `
                    <!DOCTYPE html>
                    <html lang="pt">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>Teleprompter - Ecr√£ Secund√°rio</title>
                        <style>
                            * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
                            body { background: #000; color: white; overflow: hidden; }
                            .text-content { 
                                padding: 50px; 
                                font-size: ${this.fontSize}px; 
                                line-height: 1.6; 
                                white-space: pre-wrap; 
                                transform: translateY(${window.innerHeight}px); /* Inicia fora do ecr√£ da nova janela */
                                transition: transform 0.1s linear; 
                                text-align: center; 
                                width: 100%;
                                box-sizing: border-box;
                            }
                            /* Adicionar estilos para status na nova janela, se necess√°rio */
                            .status {
                                position: fixed;
                                top: 20px;
                                right: 20px;
                                background: rgba(0, 0, 0, 0.8);
                                color: white;
                                padding: 10px 20px;
                                border-radius: 20px;
                                font-weight: bold;
                                z-index: 1001;
                                display: none;
                                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
                                opacity: 0;
                                transition: opacity 0.3s ease-in-out;
                            }
                            .status.show { display: block; opacity: 1; }
                            .status.error { background-color: #e74c3c; }
                            .status.success { background-color: #27ae60; }
                            .status.info { background-color: #3498db; }

                            @media (max-width: 768px) {
                                .text-content {
                                    padding: 30px;
                                    font-size: 32px;
                                }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="status" id="status"></div>
                        <div class="text-content" id="textContent">${this.textContent}</div>
                        <script>
                            // Script para a nova janela (mini-controlador)
                            class SecondaryTeleprompterController {
                                constructor(initialText, initialSpeed, initialFontSize) {
                                    this.isRunning = false;
                                    this.speed = initialSpeed;
                                    this.fontSize = initialFontSize;
                                    this.currentPosition = 0;
                                    this.animationId = null;
                                    this.textContent = initialText; // Recebe o texto inicial

                                    this.elements = {
                                        textContentDiv: document.getElementById('textContent'),
                                        status: document.getElementById('status')
                                    };

                                    this.elements.textContentDiv.textContent = this.textContent;
                                    this.elements.textContentDiv.style.fontSize = `${this.fontSize}px`;
                                    this.elements.textContentDiv.style.transform = \`translateY(\${window.innerHeight}px)\`;

                                    // Touch handling for the secondary window
                                    this.startY = 0;
                                    this.startTime = 0;
                                    this.isLongPress = false;
                                    this.touchSensitivity = 50;
                                    this.longPressThreshold = 500;
                                    
                                    this.setupEventListeners();
                                }

                                setupEventListeners() {
                                    document.addEventListener('keydown', (e) => this.handleKeyboard(e));
                                    this.elements.textContentDiv.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: false });
                                    this.elements.textContentDiv.addEventListener('touchend', (e) => this.handleTouchEnd(e), { passive: false });
                                    this.elements.textContentDiv.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
                                    this.elements.textContentDiv.addEventListener('click', () => this.togglePlayPause());
                                }

                                handleKeyboard(event) {
                                    // Controlos de teclado na nova janela
                                    switch(event.code) {
                                        case 'Space':
                                            event.preventDefault();
                                            this.togglePlayPause();
                                            break;
                                        case 'ArrowUp':
                                            event.preventDefault();
                                            this.adjustSpeed(0.2);
                                            break;
                                        case 'ArrowDown':
                                            event.preventDefault();
                                            this.adjustSpeed(-0.2);
                                            break;
                                        case 'ArrowLeft':
                                            event.preventDefault();
                                            this.adjustPosition(-100);
                                            break;
                                        case 'ArrowRight':
                                            event.preventDefault();
                                            this.adjustPosition(100);
                                            break;
                                        case 'Escape':
                                            event.preventDefault();
                                            window.close(); // Fecha a janela secund√°ria
                                            break;
                                        case 'KeyR':
                                            event.preventDefault();
                                            this.resetPosition();
                                            break;
                                    }
                                }

                                handleTouchStart(event) {
                                    event.preventDefault();
                                    const touch = event.touches[0];
                                    this.startY = touch.clientY;
                                    this.startTime = Date.now();
                                    this.isLongPress = false;

                                    this.longPressTimeout = setTimeout(() => {
                                        if (Date.now() - this.startTime >= this.longPressThreshold) {
                                            this.isLongPress = true;
                                            this.resetPosition();
                                            this.showStatus('Posi√ß√£o reiniciada', 'info');
                                        }
                                    }, this.longPressThreshold);
                                }

                                handleTouchEnd(event) {
                                    event.preventDefault();
                                    clearTimeout(this.longPressTimeout);
                                    if (this.isLongPress) return;

                                    const touch = event.changedTouches[0];
                                    const endY = touch.clientY;
                                    const deltaY = this.startY - endY;
                                    const deltaTime = Date.now() - this.startTime;

                                    if (Math.abs(deltaY) < 30 && deltaTime < 300) {
                                        this.togglePlayPause();
                                    } else if (Math.abs(deltaY) > this.touchSensitivity) {
                                        if (deltaY > 0) {
                                            this.adjustSpeed(0.5);
                                            this.showStatus('Velocidade aumentada', 'info');
                                        } else {
                                            if (this.speed > 0.5) {
                                                this.adjustSpeed(-0.5);
                                                this.showStatus('Velocidade diminu√≠da', 'info');
                                            } else {
                                                this.pause();
                                                this.showStatus('Pausado', 'info');
                                            }
                                        }
                                    }
                                }

                                togglePlayPause() {
                                    if (this.isRunning) {
                                        this.pause();
                                    } else {
                                        this.play();
                                    }
                                }

                                play() {
                                    this.isRunning = true;
                                    this.showStatus('Reproduzindo', 'success');
                                    this.animate();
                                }

                                pause() {
                                    this.isRunning = false;
                                    this.showStatus('Pausado', 'info');
                                    if (this.animationId) {
                                        cancelAnimationFrame(this.animationId);
                                    }
                                }

                                animate() {
                                    if (!this.isRunning) return;

                                    this.currentPosition += this.speed;
                                    this.elements.textContentDiv.style.transform = \`translateY(\${window.innerHeight - (this.currentPosition / 10)}px)\`;
                                    
                                    const maxScrollPosition = this.elements.textContentDiv.scrollHeight - (window.innerHeight * 0.1);
                                    if (this.currentPosition / 10 >= maxScrollPosition) {
                                        this.pause();
                                        this.showStatus('Fim do texto alcan√ßado', 'info');
                                        return;
                                    }

                                    this.animationId = requestAnimationFrame(() => this.animate());
                                }

                                adjustSpeed(delta) {
                                    this.speed = Math.max(0.5, Math.min(5, this.speed + delta));
                                    this.showStatus(\`Velocidade: \${this.speed.toFixed(1)}\`, 'info');
                                }

                                adjustPosition(delta) {
                                    const contentHeight = this.elements.textContentDiv.scrollHeight;
                                    const windowHeight = window.innerHeight;
                                    const maxPositionPx = contentHeight + (windowHeight * 0.1);

                                    let newPosition = this.currentPosition + delta;
                                    this.currentPosition = Math.max(0, Math.min(maxPositionPx * 10, newPosition));
                                    this.elements.textContentDiv.style.transform = \`translateY(\${window.innerHeight - (this.currentPosition / 10)}px)\`;
                                    this.showStatus('Ajustando posi√ß√£o', 'info');
                                }

                                resetPosition() {
                                    this.currentPosition = 0;
                                    this.elements.textContentDiv.style.transform = \`translateY(\${window.innerHeight}px)\`;
                                    this.showStatus('Posi√ß√£o reiniciada', 'info');
                                }

                                showStatus(message, type = 'info') {
                                    const statusElement = this.elements.status;
                                    statusElement.textContent = message;
                                    statusElement.className = \`status show \${type}\`;
                                    
                                    setTimeout(() => {
                                        statusElement.classList.remove('show');
                                    }, 3000);
                                }
                            }

                            // Inicializa o controlador secund√°rio na nova janela
                            // A janela pai passar√° os valores iniciais
                            let secondaryTeleprompterInstance;
                            window.onload = () => {
                                secondaryTeleprompterInstance = new SecondaryTeleprompterController(
                                    window.opener.teleprompter.textContent,
                                    window.opener.teleprompter.speed,
                                    window.opener.teleprompter.fontSize
                                );
                                window.teleprompterInstance = secondaryTeleprompterInstance; // Torna acess√≠vel √† janela pai
                            };
                        <\/script>
                    </body>
                    </html>
                `;

                // Abre a nova janela e escreve o HTML
                // O "fullscreen=yes" √© uma tentativa, mas pode ser limitado pelo browser
                this.newWindow = window.open('', '_blank', 'width=1920,height=1080'); // N√£o use fullscreen diretamente aqui, pode ser bloqueado
                if (this.newWindow) {
                    this.newWindow.document.write(newWindowHtml);
                    this.newWindow.document.close();
                    // Tenta colocar em fullscreen ap√≥s a abertura, pode precisar de intera√ß√£o do usu√°rio
                    // Esta chamada deve ser feita a partir de um evento de clique ou toque iniciado pelo usu√°rio para funcionar
                    // this.newWindow.document.body.requestFullscreen().catch(e => console.log("Fullscreen denied or not supported:", e));
                    
                    this.showStatus('Nova janela aberta para ecr√£ secund√°rio. Arraste para o monitor externo.', 'success');
                    // Sincroniza a posi√ß√£o inicial na nova janela
                    if (this.newWindow.teleprompterInstance) {
                        this.newWindow.teleprompterInstance.currentPosition = this.currentPosition;
                        this.newWindow.teleprompterInstance.elements.textContentDiv.style.transform = `translateY(${this.newWindow.innerHeight - (this.newWindow.teleprompterInstance.currentPosition / 10)}px)`;
                    }
                } else {
                    this.showStatus('N√£o foi poss√≠vel abrir a nova janela. Verifique as permiss√µes de pop-up.', 'error');
                }
            }

            showStatus(message, type = 'info') {
                const statusElement = this.elements.status;
                statusElement.textContent = message;
                statusElement.className = `status show ${type}`;
                
                setTimeout(() => {
                    statusElement.classList.remove('show');
                }, 3000);
            }
        }

        // Global functions for buttons
        let teleprompter;

        function startTeleprompter() {
            teleprompter.startTeleprompter();
        }

        function openNewWindow() {
            teleprompter.openNewWindow();
        }

        function resetTeleprompter() {
            teleprompter.resetTeleprompter();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            teleprompter = new TeleprompterController();
        });
    </script>
</body>
</html>
